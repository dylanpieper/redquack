<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Transfer REDCap Data to Database â€¢ redquack</title>
<script src="lightswitch.js"></script><script src="deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet">
<link href="deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet">
<script src="deps/headroom-0.11.0/headroom.min.js"></script><script src="deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="deps/search-1.0.0/fuse.min.js"></script><script src="deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="pkgdown.js"></script><meta property="og:title" content="Transfer REDCap Data to Database">
<meta name="description" content="Provides functions to transfer REDCap (Research Electronic Data Capture) data to a database with additional support for DuckDB. Processes data in chunks to handle large datasets without exceeding available memory. Features include resuming incomplete transfers, automatically converting data types for DuckDB, tracking progress, and logging operations in the database.">
<meta property="og:description" content="Provides functions to transfer REDCap (Research Electronic Data Capture) data to a database with additional support for DuckDB. Processes data in chunks to handle large datasets without exceeding available memory. Features include resuming incomplete transfers, automatically converting data types for DuckDB, tracking progress, and logging operations in the database.">
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top " aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="index.html">redquack</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.2.0</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item"><a class="nav-link" href="reference/index.html">Reference</a></li>
<li class="nav-item"><a class="nav-link" href="news/index.html">Changelog</a></li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="search.json">
</form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/dylanpieper/redquack" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
<li class="nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-lightswitch" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true" aria-label="Light switch"><span class="fa fa-sun"></span></button>
  <ul class="dropdown-menu dropdown-menu-end" aria-labelledby="dropdown-lightswitch">
<li><button class="dropdown-item" data-bs-theme-value="light"><span class="fa fa-sun"></span> Light</button></li>
    <li><button class="dropdown-item" data-bs-theme-value="dark"><span class="fa fa-moon"></span> Dark</button></li>
    <li><button class="dropdown-item" data-bs-theme-value="auto"><span class="fa fa-adjust"></span> Auto</button></li>
  </ul>
</li>
      </ul>
</div>


  </div>
</nav><div class="container template-home">
<div class="row">
  <main id="main" class="col-md-9"><div class="section level1">
<div class="page-header"><h1 id="redquack-">redquack <img src="reference/figures/redquack-hex.png" align="right" width="140"><a class="anchor" aria-label="anchor" href="#redquack-"></a>
</h1></div>
<p><a href="https://cran.r-pkg.org/package=redquack" class="external-link"><img src="https://www.r-pkg.org/badges/version/redquack" alt="CRAN status"></a> <a href="https://github.com/dylanpieper/redquack/actions/workflows/R-CMD-check.yaml" class="external-link"><img src="https://github.com/dylanpieper/redquack/actions/workflows/R-CMD-check.yaml/badge.svg" alt="R-CMD-check"></a></p>
<p>Transfer <a href="https://www.project-redcap.org/" class="external-link">REDCap</a> data to a database and use in R without exceeding available memory. Compatible with all databases but specifically optimized for <a href="https://duckdb.org/" class="external-link">DuckDB</a>â€”a fast and portable SQL engine with first-class integration in R/Posit products.</p>
<div class="section level2">
<h2 id="motivation">Motivation<a class="anchor" aria-label="anchor" href="#motivation"></a>
</h2>
<p>R objects live entirely in memory, causing three problems if not using a specialized framework:</p>
<ol style="list-style-type: decimal">
<li>You must load full datasets even if you only need a subset</li>
<li>Unused objects still consume memory</li>
<li>Large datasets can easily exceed available memory</li>
</ol>
<p>redquackâ€™s solution to this problem is to:</p>
<ol style="list-style-type: decimal">
<li>Request all of the REDCap record IDs to sequence in chunks</li>
<li>Process each chunk of the REDCap data in one R object at a time</li>
<li>Remove each object from memory after it has been transferred to the database</li>
</ol>
</div>
<div class="section level2">
<h2 id="features">Features<a class="anchor" aria-label="anchor" href="#features"></a>
</h2>
<ul>
<li>Auto-resume from incomplete transfers</li>
<li>Auto-retry for API request failures</li>
<li>Auto-convert data types for DuckDB</li>
<li>Timestamped operation logs</li>
<li>Status messages and progress bar</li>
<li>Sound notifications (ðŸ”Š ðŸ¦†)</li>
</ul>
</div>
<div class="section level2">
<h2 id="installation">Installation<a class="anchor" aria-label="anchor" href="#installation"></a>
</h2>
<p>From CRAN:</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># install.packages("pak")</span></span>
<span><span class="fu">pak</span><span class="fu">::</span><span class="fu"><a href="https://pak.r-lib.org/reference/pak.html" class="external-link">pak</a></span><span class="op">(</span><span class="st">"redquack"</span><span class="op">)</span></span></code></pre></div>
<p>Development version:</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">pak</span><span class="fu">::</span><span class="fu"><a href="https://pak.r-lib.org/reference/pak.html" class="external-link">pak</a></span><span class="op">(</span><span class="st">"dylanpieper/redquack"</span><span class="op">)</span></span></code></pre></div>
<p>These packages are used in the examples and are not imported by redquack:</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">pak</span><span class="fu">::</span><span class="fu"><a href="https://pak.r-lib.org/reference/pak.html" class="external-link">pak</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"dplyr"</span>, <span class="st">"duckdb"</span>, <span class="st">"keyring"</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="setup-api-token">Setup API Token<a class="anchor" aria-label="anchor" href="#setup-api-token"></a>
</h2>
<p>Your REDCap API token allows R to interface with REDCap and should be stored securely. I recommend using the <a href="https://keyring.r-lib.org" class="external-link">keyring</a> package to store your API token. For example:</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">keyring</span><span class="fu">::</span><span class="fu"><a href="https://keyring.r-lib.org/reference/key_get.html" class="external-link">key_set</a></span><span class="op">(</span><span class="st">"redcap_token"</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="basic-usage">Basic Usage<a class="anchor" aria-label="anchor" href="#basic-usage"></a>
</h2>
<p>Data from REDCap is transferred to a database via a <a href="https://dbi.r-dbi.org" class="external-link">DBI</a> connection in chunks of record IDs:</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va">redquack</span><span class="op">)</span></span>
<span></span>
<span><span class="va">duckdb</span> <span class="op">&lt;-</span> <span class="fu">DBI</span><span class="fu">::</span><span class="fu"><a href="https://dbi.r-dbi.org/reference/dbConnect.html" class="external-link">dbConnect</a></span><span class="op">(</span><span class="fu">duckdb</span><span class="fu">::</span><span class="fu"><a href="https://r.duckdb.org/reference/duckdb.html" class="external-link">duckdb</a></span><span class="op">(</span><span class="op">)</span>, <span class="st">"redcap.duckdb"</span><span class="op">)</span></span>
<span></span>
<span><span class="va">result</span> <span class="op">&lt;-</span> <span class="fu"><a href="reference/redcap_to_db.html">redcap_to_db</a></span><span class="op">(</span></span>
<span>  conn <span class="op">=</span> <span class="va">duckdb</span>,</span>
<span>  redcap_uri <span class="op">=</span> <span class="st">"https://redcap.example.org/api/"</span>,</span>
<span>  token <span class="op">=</span> <span class="fu">keyring</span><span class="fu">::</span><span class="fu"><a href="https://keyring.r-lib.org/reference/key_get.html" class="external-link">key_get</a></span><span class="op">(</span><span class="st">"redcap_token"</span><span class="op">)</span>,</span>
<span>  record_id_name <span class="op">=</span> <span class="st">"record_id"</span>,</span>
<span>  chunk_size <span class="op">=</span> <span class="fl">1000</span>  </span>
<span>  <span class="co"># Increase chunk size for memory-efficient systems (faster)</span></span>
<span>  <span class="co"># Decrease chunk size for memory-constrained systems (slower)</span></span>
<span><span class="op">)</span></span></code></pre></div>
<p>The function returns a list with class <code>redcap_transfer_result</code>:</p>
<ul>
<li>
<code>had_errors</code>: Logical indicating if errors occurred during the transfer</li>
<li>
<code>error_chunks</code>: Vector of chunk numbers that failed processing (if any)</li>
<li>
<code>elapsed_sec</code>: Numeric value representing total seconds for the transfer</li>
<li>
<code>processing_sec</code>: Numeric value representing seconds spent actively processing chunks</li>
<li>
<code>success</code>: Logical indicating if the transfer was complete (TRUE) or incomplete (FALSE)</li>
</ul>
</div>
<div class="section level2">
<h2 id="database-structure">Database Structure<a class="anchor" aria-label="anchor" href="#database-structure"></a>
</h2>
<p>The database created by <code><a href="reference/redcap_to_db.html">redcap_to_db()</a></code> contains two tables:</p>
<ol style="list-style-type: decimal">
<li>
<p><code>data</code>: Contains all exported REDCap records with optimized column types</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">data</span> <span class="op">&lt;-</span> <span class="fu">DBI</span><span class="fu">::</span><span class="fu"><a href="https://dbi.r-dbi.org/reference/dbGetQuery.html" class="external-link">dbGetQuery</a></span><span class="op">(</span><span class="va">duckdb</span>, <span class="st">"SELECT * FROM data LIMIT 1000"</span><span class="op">)</span></span></code></pre></div>
</li>
<li>
<p><code>log</code>: Contains timestamped logs of the transfer process for troubleshooting</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">log</span> <span class="op">&lt;-</span> <span class="fu">DBI</span><span class="fu">::</span><span class="fu"><a href="https://dbi.r-dbi.org/reference/dbGetQuery.html" class="external-link">dbGetQuery</a></span><span class="op">(</span><span class="va">duckdb</span>, <span class="st">"SELECT * FROM log"</span><span class="op">)</span></span></code></pre></div>
</li>
</ol>
</div>
<div class="section level2">
<h2 id="data-types">Data Types<a class="anchor" aria-label="anchor" href="#data-types"></a>
</h2>
<p>Data is first set to <strong>VARCHAR/TEXT</strong> type for consistent handling across chunks.</p>
<p>For DuckDB, data types are automatically optimized after transfer to improve query performance:</p>
<ul>
<li>
<strong>INTEGER</strong>: Columns with only whole numbers</li>
<li>
<strong>DOUBLE</strong>: Columns with decimal numbers</li>
<li>
<strong>DATE</strong>: Columns with valid dates</li>
<li>
<strong>TIMESTAMP</strong>: Columns with valid timestamps</li>
<li>
<strong>VARCHAR/TEXT</strong>: All other columns remain as strings</li>
</ul>
<p>In DuckDB, you can query the data to inspect the data types:</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">DBI</span><span class="fu">::</span><span class="fu"><a href="https://dbi.r-dbi.org/reference/dbGetQuery.html" class="external-link">dbGetQuery</a></span><span class="op">(</span><span class="va">duckdb</span>, <span class="st">"PRAGMA table_info(data)"</span><span class="op">)</span></span></code></pre></div>
<p>You can also automatically convert data types in R using <a href="#id_0">readr</a>:</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">readr</span><span class="fu">::</span><span class="fu"><a href="https://readr.tidyverse.org/reference/type_convert.html" class="external-link">type_convert</a></span><span class="op">(</span><span class="va">data</span><span class="op">)</span></span></code></pre></div>
<p>To optimize query performance with other databases, you must alter your data table manually.</p>
<div class="section level3">
<h3 id="data-manipulation">Data Manipulation<a class="anchor" aria-label="anchor" href="#data-manipulation"></a>
</h3>
<p>Query and collect the data with <a href="https://dplyr.tidyverse.org" class="external-link">dplyr</a>:</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://dplyr.tidyverse.org" class="external-link">dplyr</a></span><span class="op">)</span></span>
<span></span>
<span><span class="va">demographics</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/tbl.html" class="external-link">tbl</a></span><span class="op">(</span><span class="va">duckdb</span>, <span class="st">"data"</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/NA.html" class="external-link">is.na</a></span><span class="op">(</span><span class="va">redcap_repeat_instrument</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="va">record_id</span>, <span class="va">age</span>, <span class="va">race</span>, <span class="va">sex</span>, <span class="va">gender</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/compute.html" class="external-link">collect</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<p>If you <code><a href="https://dplyr.tidyverse.org/reference/compute.html" class="external-link">collect()</a></code> your data into memory in the last step, it can make a slow process nearly instantaneous. The following example data is 2,819,697 rows x 397 columns:</p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/system.time.html" class="external-link">system.time</a></span><span class="op">(</span></span>
<span>  <span class="va">records</span> <span class="op">&lt;-</span> <span class="va">duckdb</span> <span class="op">|&gt;</span></span>
<span>    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/tbl.html" class="external-link">tbl</a></span><span class="op">(</span><span class="st">"data"</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/compute.html" class="external-link">collect</a></span><span class="op">(</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html" class="external-link">group_by</a></span><span class="op">(</span><span class="va">redcap_repeat_instrument</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/summarise.html" class="external-link">summarize</a></span><span class="op">(</span>count <span class="op">=</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/context.html" class="external-link">n</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/arrange.html" class="external-link">arrange</a></span><span class="op">(</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/desc.html" class="external-link">desc</a></span><span class="op">(</span><span class="va">count</span><span class="op">)</span><span class="op">)</span> </span>
<span><span class="op">)</span></span>
<span><span class="co">#&gt;    user  system elapsed</span></span>
<span><span class="co">#&gt;  20.748  10.455  32.916</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/system.time.html" class="external-link">system.time</a></span><span class="op">(</span></span>
<span>  <span class="va">records</span> <span class="op">&lt;-</span> <span class="va">duckdb</span> <span class="op">|&gt;</span></span>
<span>    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/tbl.html" class="external-link">tbl</a></span><span class="op">(</span><span class="st">"data"</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html" class="external-link">group_by</a></span><span class="op">(</span><span class="va">redcap_repeat_instrument</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/summarise.html" class="external-link">summarize</a></span><span class="op">(</span>count <span class="op">=</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/context.html" class="external-link">n</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/arrange.html" class="external-link">arrange</a></span><span class="op">(</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/desc.html" class="external-link">desc</a></span><span class="op">(</span><span class="va">count</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/compute.html" class="external-link">collect</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span><span class="co">#&gt;    user  system elapsed</span></span>
<span><span class="co">#&gt;   0.040   0.015   0.040</span></span></code></pre></div>
<p>You can also write a Parquet file directly from DuckDB to take advantage of the features of <a href="https://arrow.apache.org/docs/r/" class="external-link">arrow</a>:</p>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">DBI</span><span class="fu">::</span><span class="fu"><a href="https://dbi.r-dbi.org/reference/dbExecute.html" class="external-link">dbExecute</a></span><span class="op">(</span><span class="va">duckdb</span>, <span class="st">"COPY (SELECT * FROM data) TO 'redcap.parquet' (FORMAT PARQUET)"</span><span class="op">)</span></span></code></pre></div>
<p>Remember to close the connection when finished:</p>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">DBI</span><span class="fu">::</span><span class="fu"><a href="https://dbi.r-dbi.org/reference/dbDisconnect.html" class="external-link">dbDisconnect</a></span><span class="op">(</span><span class="va">duckdb</span><span class="op">)</span></span></code></pre></div>
</div>
</div>
<div class="section level2">
<h2 id="other-redcap-interfaces">Other REDCap Interfaces<a class="anchor" aria-label="anchor" href="#other-redcap-interfaces"></a>
</h2>
<ul>
<li><p><a href="https://github.com/vubiostat/redcapAPI" class="external-link">redcapAPI</a> (R package; provides a package comparison table)</p></li>
<li><p><a href="https://redcap-tools.github.io/PyCap/" class="external-link">PyCap</a> (python module)</p></li>
</ul>
</div>
</div>
  </main><aside class="col-md-3"><div class="links">
<h2 data-toc-skip>Links</h2>
<ul class="list-unstyled">
<li><a href="https://cloud.r-project.org/package=redquack" class="external-link">View on CRAN</a></li>
<li><a href="https://github.com/dylanpieper/redquack" class="external-link">Browse source code</a></li>
</ul>
</div>

<div class="license">
<h2 data-toc-skip>License</h2>
<ul class="list-unstyled">
<li><a href="LICENSE.html">Full license</a></li>
<li><small><a href="https://opensource.org/licenses/mit-license.php" class="external-link">MIT</a> + file <a href="LICENSE-text.html">LICENSE</a></small></li>
</ul>
</div>


<div class="citation">
<h2 data-toc-skip>Citation</h2>
<ul class="list-unstyled">
<li><a href="authors.html#citation">Citing redquack</a></li>
</ul>
</div>

<div class="developers">
<h2 data-toc-skip>Developers</h2>
<ul class="list-unstyled">
<li>Dylan Pieper <br><small class="roles"> Author, maintainer </small>   </li>
</ul>
</div>



  </aside>
</div>


    <footer><div class="pkgdown-footer-left">
  <p>Developed by Dylan Pieper.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.2.</p>
</div>

    </footer>
</div>





  </body>
</html>
