<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><title>Transfer 'REDCap' Data to 'DuckDB' — redcap_to_duckdb • redquack</title><script src="../lightswitch.js"></script><script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet"><script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet"><link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet"><script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Transfer 'REDCap' Data to 'DuckDB' — redcap_to_duckdb"><meta name="description" content="Transfer REDCap data to DuckDB in chunks to minimize memory usage."><meta property="og:description" content="Transfer REDCap data to DuckDB in chunks to minimize memory usage."></head><body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top " aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">redquack</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.1.1</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto"><li class="active nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="nav-item"><a class="nav-link" href="../news/index.html">Changelog</a></li>
      </ul><ul class="navbar-nav"><li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json"></form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/dylanpieper/redquack" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
<li class="nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-lightswitch" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true" aria-label="Light switch"><span class="fa fa-sun"></span></button>
  <ul class="dropdown-menu dropdown-menu-end" aria-labelledby="dropdown-lightswitch"><li><button class="dropdown-item" data-bs-theme-value="light"><span class="fa fa-sun"></span> Light</button></li>
    <li><button class="dropdown-item" data-bs-theme-value="dark"><span class="fa fa-moon"></span> Dark</button></li>
    <li><button class="dropdown-item" data-bs-theme-value="auto"><span class="fa fa-adjust"></span> Auto</button></li>
  </ul></li>
      </ul></div>


  </div>
</nav><div class="container template-reference-topic">
<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">

      <h1>Transfer 'REDCap' Data to 'DuckDB'</h1>

      <div class="d-none name"><code>redcap_to_duckdb.Rd</code></div>
    </div>

    <div class="ref-description section level2">
    <p>Transfer REDCap data to DuckDB in chunks to minimize memory usage.</p>
    </div>

    <div class="section level2">
    <h2 id="ref-usage">Usage<a class="anchor" aria-label="anchor" href="#ref-usage"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span><span class="fu">redcap_to_duckdb</span><span class="op">(</span></span>
<span>  <span class="va">redcap_uri</span>,</span>
<span>  <span class="va">token</span>,</span>
<span>  output_file <span class="op">=</span> <span class="st">"redcap.duckdb"</span>,</span>
<span>  chunk_size <span class="op">=</span> <span class="fl">1000</span>,</span>
<span>  chunk_delay <span class="op">=</span> <span class="fl">0.5</span>,</span>
<span>  max_retries <span class="op">=</span> <span class="fl">3</span>,</span>
<span>  raw_or_label <span class="op">=</span> <span class="st">"raw"</span>,</span>
<span>  raw_or_label_headers <span class="op">=</span> <span class="st">"raw"</span>,</span>
<span>  export_checkbox_label <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>  export_survey_fields <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>  export_data_access_groups <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>  filter_logic <span class="op">=</span> <span class="st">""</span>,</span>
<span>  datetime_range_begin <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/as.POSIXlt.html" class="external-link">as.POSIXct</a></span><span class="op">(</span><span class="cn">NA</span><span class="op">)</span>,</span>
<span>  datetime_range_end <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/as.POSIXlt.html" class="external-link">as.POSIXct</a></span><span class="op">(</span><span class="cn">NA</span><span class="op">)</span>,</span>
<span>  blank_for_gray_form_status <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>  fields <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  forms <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  events <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  id_field <span class="op">=</span> <span class="st">"id"</span>,</span>
<span>  optimize_types <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>  return_duckdb <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>  verbose <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>  beep <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>  <span class="va">...</span></span>
<span><span class="op">)</span></span></code></pre></div>
    </div>

    <div class="section level2">
    <h2 id="arguments">Arguments<a class="anchor" aria-label="anchor" href="#arguments"></a></h2>


<dl><dt id="arg-redcap-uri">redcap_uri<a class="anchor" aria-label="anchor" href="#arg-redcap-uri"></a></dt>
<dd><p>Character string specifying the URI (uniform resource identifier)
of the REDCap server's API.</p></dd>


<dt id="arg-token">token<a class="anchor" aria-label="anchor" href="#arg-token"></a></dt>
<dd><p>Character string containing the REDCap API token specific to your project.
This token is used for authentication and must have export permissions.</p></dd>


<dt id="arg-output-file">output_file<a class="anchor" aria-label="anchor" href="#arg-output-file"></a></dt>
<dd><p>Character string specifying the file path where the DuckDB database
will be created or modified. Default is "redcap.duckdb" in current working directory.</p></dd>


<dt id="arg-chunk-size">chunk_size<a class="anchor" aria-label="anchor" href="#arg-chunk-size"></a></dt>
<dd><p>Integer specifying the number of record IDs to process per chunk.
Default is 1000. Consider decreasing this for projects with many fields.</p></dd>


<dt id="arg-chunk-delay">chunk_delay<a class="anchor" aria-label="anchor" href="#arg-chunk-delay"></a></dt>
<dd><p>Numeric value specifying the delay in seconds between chunked
requests. Default is 0.5 seconds. Adjust to respect REDCap server limits.</p></dd>


<dt id="arg-max-retries">max_retries<a class="anchor" aria-label="anchor" href="#arg-max-retries"></a></dt>
<dd><p>Integer specifying the maximum number of retry attempts for failed
API requests. Default is 3. Set to 0 to disable retries.</p></dd>


<dt id="arg-raw-or-label">raw_or_label<a class="anchor" aria-label="anchor" href="#arg-raw-or-label"></a></dt>
<dd><p>A string (either <code>'raw'</code> or <code>'label'</code>) that specifies
whether to export the raw coded values or the labels for the options of
multiple choice fields. Default is <code>'raw'</code>.</p></dd>


<dt id="arg-raw-or-label-headers">raw_or_label_headers<a class="anchor" aria-label="anchor" href="#arg-raw-or-label-headers"></a></dt>
<dd><p>A string (either <code>'raw'</code> or <code>'label'</code>) that
specifies for the CSV headers whether to export the variable/field names
(raw) or the field labels (label). Default is <code>'raw'</code>.</p></dd>


<dt id="arg-export-checkbox-label">export_checkbox_label<a class="anchor" aria-label="anchor" href="#arg-export-checkbox-label"></a></dt>
<dd><p>Logical that specifies the format of checkbox field values
specifically when exporting the data as labels. If <code>raw_or_label</code> is
<code>'label'</code> and <code>export_checkbox_label</code> is TRUE, the values will be the text
displayed to the users. Otherwise, the values will be 0/1. Default is FALSE.</p></dd>


<dt id="arg-export-survey-fields">export_survey_fields<a class="anchor" aria-label="anchor" href="#arg-export-survey-fields"></a></dt>
<dd><p>Logical that specifies whether to export the
survey identifier field (e.g., 'redcap_survey_identifier') or survey
timestamp fields. Default is FALSE.</p></dd>


<dt id="arg-export-data-access-groups">export_data_access_groups<a class="anchor" aria-label="anchor" href="#arg-export-data-access-groups"></a></dt>
<dd><p>Logical that specifies whether or not to export
the <code>redcap_data_access_group</code> field when data access groups are utilized
in the project. Default is FALSE.</p></dd>


<dt id="arg-filter-logic">filter_logic<a class="anchor" aria-label="anchor" href="#arg-filter-logic"></a></dt>
<dd><p>String of logic text (e.g., <code>[gender] = 'male'</code>) for
filtering the data to be returned, where the API will only return records
where the logic evaluates as TRUE. Default is an empty string.</p></dd>


<dt id="arg-datetime-range-begin">datetime_range_begin<a class="anchor" aria-label="anchor" href="#arg-datetime-range-begin"></a></dt>
<dd><p>To return only records that have been created or
modified <em>after</em> a given datetime, provide a POSIXct value.
Default is NA (no begin time).</p></dd>


<dt id="arg-datetime-range-end">datetime_range_end<a class="anchor" aria-label="anchor" href="#arg-datetime-range-end"></a></dt>
<dd><p>To return only records that have been created or
modified <em>before</em> a given datetime, provide a POSIXct value.
Default is NA (no end time).</p></dd>


<dt id="arg-blank-for-gray-form-status">blank_for_gray_form_status<a class="anchor" aria-label="anchor" href="#arg-blank-for-gray-form-status"></a></dt>
<dd><p>Logical that specifies whether
or not to export blank values for instrument complete status fields that have
a gray status icon. Default is FALSE.</p></dd>


<dt id="arg-fields">fields<a class="anchor" aria-label="anchor" href="#arg-fields"></a></dt>
<dd><p>Character vector specifying which fields to export.
Default is NULL (all fields).</p></dd>


<dt id="arg-forms">forms<a class="anchor" aria-label="anchor" href="#arg-forms"></a></dt>
<dd><p>Character vector specifying which forms to export.
Default is NULL (all forms).</p></dd>


<dt id="arg-events">events<a class="anchor" aria-label="anchor" href="#arg-events"></a></dt>
<dd><p>Character vector specifying which events to export.
Default is NULL (all events).</p></dd>


<dt id="arg-id-field">id_field<a class="anchor" aria-label="anchor" href="#arg-id-field"></a></dt>
<dd><p>Character string specifying the field name that contains record
identifiers. Default is "id".</p></dd>


<dt id="arg-optimize-types">optimize_types<a class="anchor" aria-label="anchor" href="#arg-optimize-types"></a></dt>
<dd><p>Logical indicating whether column types should be optimized
after all data is inserted. Default is TRUE, which analyzes column content and
converts VARCHAR to more appropriate types (INTEGER, DOUBLE, DATE, TIMESTAMP).
If FALSE, all columns will remain as VARCHAR regardless of content.</p></dd>


<dt id="arg-return-duckdb">return_duckdb<a class="anchor" aria-label="anchor" href="#arg-return-duckdb"></a></dt>
<dd><p>Logical indicating whether to return a DBI connection object.
Default is TRUE. If FALSE, return NULL invisibly.</p></dd>


<dt id="arg-verbose">verbose<a class="anchor" aria-label="anchor" href="#arg-verbose"></a></dt>
<dd><p>Logical indicating whether to show progress and completion messages.
Default is TRUE.</p></dd>


<dt id="arg-beep">beep<a class="anchor" aria-label="anchor" href="#arg-beep"></a></dt>
<dd><p>Logical indicating whether to play sound notifications when the process
completes or encounters errors. Default is TRUE.</p></dd>


<dt id="arg--">...<a class="anchor" aria-label="anchor" href="#arg--"></a></dt>
<dd><p>Additional arguments passed to the REDCap API call.</p></dd>

</dl></div>
    <div class="section level2">
    <h2 id="value">Value<a class="anchor" aria-label="anchor" href="#value"></a></h2>
    <p>If <code>return_duckdb</code> is TRUE, returns a DBI connection object to the DuckDB database,
whether newly created, partially completed and resumed, or already complete.
Connection has attributes:</p><ul><li><p><code>had_errors</code>: Logical indicating if errors occurred during the transfer</p></li>
<li><p><code>error_chunks</code>: Vector of chunk numbers that failed processing (if any)</p></li>
</ul><p>If <code>return_duckdb</code> is FALSE, returns invisibly.</p>
    </div>
    <div class="section level2">
    <h2 id="details">Details<a class="anchor" aria-label="anchor" href="#details"></a></h2>
    <p>This function transfers data from REDCap to DuckDB in chunks, which helps manage memory
usage when dealing with large projects. It creates two tables in the DuckDB database:</p><ul><li><p><code>data</code>: Contains all transferred REDCap records</p></li>
<li><p><code>log</code>: Contains timestamped logs of the transfer process</p></li>
</ul><p>The function automatically detects existing databases and handles them in three ways:</p><ul><li><p>If no database exists, starts a new transfer process</p></li>
<li><p>If a database exists but is incomplete, resumes from the last processed record ID</p></li>
<li><p>If a database exists and is complete, returns a connection without reprocessing</p></li>
</ul><p>The function fetches record IDs first, then processes records in chunks.
If any error occurs during processing, the function will stop further processing
to prevent incomplete data. Memory is explicitly managed to handle large datasets.</p>
<p>All data is initially stored as VARCHAR type for consistent handling across chunks.
When <code>optimize_types = TRUE</code> (the default), column types are automatically converted
after all data is inserted, based on content analysis:</p><ul><li><p>Columns containing only integers are converted to INTEGER</p></li>
<li><p>Columns containing numeric values are converted to DOUBLE</p></li>
<li><p>Columns with valid date strings are converted to DATE</p></li>
<li><p>Columns with valid timestamp strings are converted to TIMESTAMP</p></li>
<li><p>All other columns remain as VARCHAR</p></li>
</ul><p>When <code>optimize_types = FALSE</code>, all columns remain as VARCHAR type. This can be useful
when:</p><ul><li><p>You need consistent string-based handling of all data</p></li>
<li><p>You're working with complex mixed-type data</p></li>
<li><p>You plan to handle type conversions manually in subsequent SQL queries</p></li>
<li><p>Import speed is prioritized over storage efficiency or query optimization</p></li>
</ul></div>
    <div class="section level2">
    <h2 id="database-connection">Database Connection<a class="anchor" aria-label="anchor" href="#database-connection"></a></h2>


<p>The function returns an open connection to the DuckDB database when <code>return_duckdb = TRUE</code>.
You must explicitly close this connection with <code><a href="https://dbi.r-dbi.org/reference/dbDisconnect.html" class="external-link">DBI::dbDisconnect()</a></code> when finished.</p>
    </div>
    <div class="section level2">
    <h2 id="see-also">See also<a class="anchor" aria-label="anchor" href="#see-also"></a></h2>
    <div class="dont-index"><p><code><a href="https://dbi.r-dbi.org/reference/dbConnect.html" class="external-link">dbConnect</a></code> for database connection details
<code><a href="https://r.duckdb.org/reference/duckdb.html" class="external-link">duckdb</a></code> for DuckDB database information
<code><a href="https://httr2.r-lib.org/reference/req_retry.html" class="external-link">req_retry</a></code> for retry functionality details</p></div>
    </div>

    <div class="section level2">
    <h2 id="ref-examples">Examples<a class="anchor" aria-label="anchor" href="#ref-examples"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span class="r-in"><span><span class="kw">if</span> <span class="op">(</span><span class="cn">FALSE</span><span class="op">)</span> <span class="op">{</span> <span class="co"># \dontrun{</span></span></span>
<span class="r-in"><span><span class="co"># Basic usage with API token</span></span></span>
<span class="r-in"><span><span class="va">con</span> <span class="op">&lt;-</span> <span class="fu">redcap_to_duckdb</span><span class="op">(</span></span></span>
<span class="r-in"><span>  redcap_uri <span class="op">=</span> <span class="st">"https://redcap.example.org/api/"</span>,</span></span>
<span class="r-in"><span>  token <span class="op">=</span> <span class="st">"YOUR_API_TOKEN"</span>,</span></span>
<span class="r-in"><span>  chunk_size <span class="op">=</span> <span class="fl">1000</span></span></span>
<span class="r-in"><span>  <span class="co"># Increase chunk size for memory-efficient systems (faster)</span></span></span>
<span class="r-in"><span>  <span class="co"># Decrease chunk size for memory-constrained systems (slower)</span></span></span>
<span class="r-in"><span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Query the resulting database</span></span></span>
<span class="r-in"><span><span class="va">data</span> <span class="op">&lt;-</span> <span class="fu">DBI</span><span class="fu">::</span><span class="fu"><a href="https://dbi.r-dbi.org/reference/dbGetQuery.html" class="external-link">dbGetQuery</a></span><span class="op">(</span><span class="va">con</span>, <span class="st">"SELECT * FROM data LIMIT 10"</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># View transfer logs</span></span></span>
<span class="r-in"><span><span class="va">logs</span> <span class="op">&lt;-</span> <span class="fu">DBI</span><span class="fu">::</span><span class="fu"><a href="https://dbi.r-dbi.org/reference/dbGetQuery.html" class="external-link">dbGetQuery</a></span><span class="op">(</span><span class="va">con</span>, <span class="st">"SELECT * FROM log"</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Remember to close the connection</span></span></span>
<span class="r-in"><span><span class="fu">DBI</span><span class="fu">::</span><span class="fu"><a href="https://dbi.r-dbi.org/reference/dbDisconnect.html" class="external-link">dbDisconnect</a></span><span class="op">(</span><span class="va">con</span>, shutdown <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="op">}</span> <span class="co"># }</span></span></span>
</code></pre></div>
    </div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside></div>


    <footer><div class="pkgdown-footer-left">
  <p>Developed by Dylan Pieper.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.1.</p>
</div>

    </footer></div>





  </body></html>

