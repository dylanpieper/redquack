<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><title>Export REDCap data to DuckDB — redcap_to_duckdb • redquack</title><script src="../lightswitch.js"></script><script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet"><script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet"><link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet"><script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Export REDCap data to DuckDB — redcap_to_duckdb"><meta name="description" content="Read REDCap project data and save it to a DuckDB database file.
Process data in batches to handle large projects while minimizing memory usage."><meta property="og:description" content="Read REDCap project data and save it to a DuckDB database file.
Process data in batches to handle large projects while minimizing memory usage."></head><body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top " aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">redquack</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.1.0</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto"><li class="active nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
      </ul><ul class="navbar-nav"><li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json"></form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/dylanpieper/redquack" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
<li class="nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-lightswitch" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true" aria-label="Light switch"><span class="fa fa-sun"></span></button>
  <ul class="dropdown-menu dropdown-menu-end" aria-labelledby="dropdown-lightswitch"><li><button class="dropdown-item" data-bs-theme-value="light"><span class="fa fa-sun"></span> Light</button></li>
    <li><button class="dropdown-item" data-bs-theme-value="dark"><span class="fa fa-moon"></span> Dark</button></li>
    <li><button class="dropdown-item" data-bs-theme-value="auto"><span class="fa fa-adjust"></span> Auto</button></li>
  </ul></li>
      </ul></div>


  </div>
</nav><div class="container template-reference-topic">
<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">

      <h1>Export REDCap data to DuckDB</h1>

      <div class="d-none name"><code>redcap_to_duckdb.Rd</code></div>
    </div>

    <div class="ref-description section level2">
    <p>Read REDCap project data and save it to a DuckDB database file.
Process data in batches to handle large projects while minimizing memory usage.</p>
    </div>

    <div class="section level2">
    <h2 id="ref-usage">Usage<a class="anchor" aria-label="anchor" href="#ref-usage"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span><span class="fu">redcap_to_duckdb</span><span class="op">(</span></span>
<span>  <span class="va">redcap_uri</span>,</span>
<span>  <span class="va">token</span>,</span>
<span>  output_file <span class="op">=</span> <span class="st">"redcap.duckdb"</span>,</span>
<span>  chunk_size <span class="op">=</span> <span class="fl">2000</span>,</span>
<span>  chunk_delay <span class="op">=</span> <span class="fl">0.5</span>,</span>
<span>  id_field <span class="op">=</span> <span class="st">"id"</span>,</span>
<span>  optimize_types <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>  return_duckdb <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>  suppress_warnings <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>  beep <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>  <span class="va">...</span></span>
<span><span class="op">)</span></span></code></pre></div>
    </div>

    <div class="section level2">
    <h2 id="arguments">Arguments<a class="anchor" aria-label="anchor" href="#arguments"></a></h2>


<dl><dt id="arg-redcap-uri">redcap_uri<a class="anchor" aria-label="anchor" href="#arg-redcap-uri"></a></dt>
<dd><p>Character string specifying the URI (uniform resource identifier)
of the REDCap server's API.</p></dd>


<dt id="arg-token">token<a class="anchor" aria-label="anchor" href="#arg-token"></a></dt>
<dd><p>Character string containing the REDCap API token specific to your project.
This token is used for authentication and must have export permissions.</p></dd>


<dt id="arg-output-file">output_file<a class="anchor" aria-label="anchor" href="#arg-output-file"></a></dt>
<dd><p>Character string specifying the file path where the DuckDB database
will be created or modified. Default is "redcap.duckdb" in current working directory.</p></dd>


<dt id="arg-chunk-size">chunk_size<a class="anchor" aria-label="anchor" href="#arg-chunk-size"></a></dt>
<dd><p>Integer specifying the number of record IDs to process per batch.
Default is 2000. Consider decreasing this for projects with many fields.</p></dd>


<dt id="arg-chunk-delay">chunk_delay<a class="anchor" aria-label="anchor" href="#arg-chunk-delay"></a></dt>
<dd><p>Numeric value specifying the delay in seconds between batch
requests. Default is 0.5 seconds. Adjust to respect REDCap server limits.</p></dd>


<dt id="arg-id-field">id_field<a class="anchor" aria-label="anchor" href="#arg-id-field"></a></dt>
<dd><p>Character string specifying the field name that contains record
identifiers. Default is "id".</p></dd>


<dt id="arg-optimize-types">optimize_types<a class="anchor" aria-label="anchor" href="#arg-optimize-types"></a></dt>
<dd><p>Logical indicating whether column types should be optimized
after all data is inserted. Default is TRUE, which analyzes column content and
converts VARCHAR to more appropriate types (INTEGER, DOUBLE, DATE, TIMESTAMP).
If FALSE, all columns will remain as VARCHAR regardless of content.</p></dd>


<dt id="arg-return-duckdb">return_duckdb<a class="anchor" aria-label="anchor" href="#arg-return-duckdb"></a></dt>
<dd><p>Logical indicating whether to return a DBI connection object.
Default is TRUE. If FALSE, return NULL invisibly.</p></dd>


<dt id="arg-suppress-warnings">suppress_warnings<a class="anchor" aria-label="anchor" href="#arg-suppress-warnings"></a></dt>
<dd><p>Logical indicating whether to suppress common REDCap parsing
warnings. Default is TRUE.</p></dd>


<dt id="arg-beep">beep<a class="anchor" aria-label="anchor" href="#arg-beep"></a></dt>
<dd><p>Logical indicating whether to play sound notifications when the process
completes or encounters errors. Default is TRUE.</p></dd>


<dt id="arg--">...<a class="anchor" aria-label="anchor" href="#arg--"></a></dt>
<dd><p>Additional arguments passed to <code><a href="https://ouhscbbmc.github.io/REDCapR/reference/redcap_read_oneshot.html" class="external-link">REDCapR::redcap_read_oneshot()</a></code>.</p></dd>

</dl></div>
    <div class="section level2">
    <h2 id="value">Value<a class="anchor" aria-label="anchor" href="#value"></a></h2>
    <p>If <code>return_duckdb</code> is TRUE, returns a DBI connection object to the DuckDB database.
Connection has attributes:</p><ul><li><p><code>had_errors</code>: Logical indicating if errors occurred during extraction</p></li>
<li><p><code>error_batches</code>: Vector of batch numbers that failed processing (if any)</p></li>
</ul><p>If <code>return_duckdb</code> is FALSE, returns invisibly.</p>
    </div>
    <div class="section level2">
    <h2 id="details">Details<a class="anchor" aria-label="anchor" href="#details"></a></h2>
    <p>This function extracts data from a REDCap project in batches, which helps manage memory
usage when dealing with large projects. It creates two tables in the DuckDB database:</p><ul><li><p><code>data</code>: Contains all extracted REDCap records</p></li>
<li><p><code>log</code>: Contains timestamped logs of the extraction process</p></li>
</ul><p>The function fetches record IDs first, then processes records in batches.
If any error occurs during batch processing, the function will stop further processing
to prevent incomplete data. Memory is explicitly managed to handle large datasets.</p>
<p>All data is initially stored as VARCHAR type for consistent handling across batches.
When <code>optimize_types = TRUE</code> (the default), column types are automatically converted
after all data is inserted, based on content analysis:</p><ul><li><p>Columns containing only integers are converted to INTEGER</p></li>
<li><p>Columns containing numeric values are converted to DOUBLE</p></li>
<li><p>Columns with valid date strings are converted to DATE</p></li>
<li><p>Columns with valid timestamp strings are converted to TIMESTAMP</p></li>
<li><p>All other columns remain as VARCHAR</p></li>
</ul><p>When <code>optimize_types = FALSE</code>, all columns remain as VARCHAR type. This can be useful
when:</p><ul><li><p>You need consistent string-based handling of all data</p></li>
<li><p>You're working with complex mixed-type data</p></li>
<li><p>You plan to handle type conversions manually in subsequent SQL queries</p></li>
<li><p>Import speed is prioritized over storage efficiency or query optimization</p></li>
</ul></div>
    <div class="section level2">
    <h2 id="database-connection">Database Connection<a class="anchor" aria-label="anchor" href="#database-connection"></a></h2>


<p>The function returns an open connection to the DuckDB database when <code>return_duckdb = TRUE</code>.
You must explicitly close this connection with <code><a href="https://dbi.r-dbi.org/reference/dbDisconnect.html" class="external-link">DBI::dbDisconnect()</a></code> when finished.</p>
    </div>
    <div class="section level2">
    <h2 id="see-also">See also<a class="anchor" aria-label="anchor" href="#see-also"></a></h2>
    <div class="dont-index"><p><code><a href="https://ouhscbbmc.github.io/REDCapR/reference/redcap_read_oneshot.html" class="external-link">redcap_read_oneshot</a></code> for the underlying data extraction function
<code><a href="https://dbi.r-dbi.org/reference/dbConnect.html" class="external-link">dbConnect</a></code> for database connection details
<code><a href="https://r.duckdb.org/reference/duckdb.html" class="external-link">duckdb</a></code> for DuckDB database information</p></div>
    </div>

    <div class="section level2">
    <h2 id="ref-examples">Examples<a class="anchor" aria-label="anchor" href="#ref-examples"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span class="r-in"><span><span class="kw">if</span> <span class="op">(</span><span class="cn">FALSE</span><span class="op">)</span> <span class="op">{</span> <span class="co"># \dontrun{</span></span></span>
<span class="r-in"><span><span class="co"># Basic usage with API token</span></span></span>
<span class="r-in"><span><span class="va">con</span> <span class="op">&lt;-</span> <span class="fu">redcap_to_duckdb</span><span class="op">(</span></span></span>
<span class="r-in"><span>  redcap_uri <span class="op">=</span> <span class="st">"https://redcap.example.org/api/"</span>,</span></span>
<span class="r-in"><span>  token <span class="op">=</span> <span class="st">"YOUR_API_TOKEN"</span></span></span>
<span class="r-in"><span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Alternatively, suppress console messages</span></span></span>
<span class="r-in"><span><span class="va">con</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/message.html" class="external-link">suppressMessages</a></span><span class="op">(</span><span class="fu">redcap_to_duckdb</span><span class="op">(</span></span></span>
<span class="r-in"><span>  redcap_uri <span class="op">=</span> <span class="st">"https://redcap.example.org/api/"</span>,</span></span>
<span class="r-in"><span>  token <span class="op">=</span> <span class="st">"YOUR_API_TOKEN"</span></span></span>
<span class="r-in"><span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Query the resulting database</span></span></span>
<span class="r-in"><span><span class="va">records</span> <span class="op">&lt;-</span> <span class="fu">DBI</span><span class="fu">::</span><span class="fu"><a href="https://dbi.r-dbi.org/reference/dbGetQuery.html" class="external-link">dbGetQuery</a></span><span class="op">(</span><span class="va">con</span>, <span class="st">"SELECT * FROM data LIMIT 10"</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># View extraction logs</span></span></span>
<span class="r-in"><span><span class="va">logs</span> <span class="op">&lt;-</span> <span class="fu">DBI</span><span class="fu">::</span><span class="fu"><a href="https://dbi.r-dbi.org/reference/dbGetQuery.html" class="external-link">dbGetQuery</a></span><span class="op">(</span><span class="va">con</span>, <span class="st">"SELECT * FROM log"</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Remember to close the connection</span></span></span>
<span class="r-in"><span><span class="fu">DBI</span><span class="fu">::</span><span class="fu"><a href="https://dbi.r-dbi.org/reference/dbDisconnect.html" class="external-link">dbDisconnect</a></span><span class="op">(</span><span class="va">con</span>, shutdown <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="op">}</span> <span class="co"># }</span></span></span>
</code></pre></div>
    </div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside></div>


    <footer><div class="pkgdown-footer-left">
  <p>Developed by Dylan Pieper.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.1.</p>
</div>

    </footer></div>





  </body></html>

